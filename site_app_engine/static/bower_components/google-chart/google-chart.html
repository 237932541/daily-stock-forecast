<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-ajax/iron-request.html"><link rel="import" href="google-chart-loader.html"><link rel="import" href="google-chart-styles.html"></head><body><dom-module id="google-chart"><template><style include="google-chart-styles"></style><google-chart-loader id="loader" type="[[type]]"></google-chart-loader><div id="chartdiv"></div></template></dom-module><script>(function(){'use strict';Polymer({is:'google-chart',properties:{type:{type:String,value:'column',observer:'_typeChanged'},events:{type:Array,value:function(){return[]}},options:{type:Object},cols:{type:Array,observer:'_rowsOrColumnsChanged'},rows:{type:Array,observer:'_rowsOrColumnsChanged'},data:{type:String,observer:'_dataChanged'},view:{type:Object,observer:'_viewChanged'},selection:{type:Array,notify:!0,observer:'_setSelection'},drawn:{type:Boolean,readOnly:!0,value:!1}},observers:['_draw(_chart, _dataView)','_subOptionChanged(options.*)'],listeners:{"google-chart-select":'_updateSelection',"google-chart-ready":'_onChartReady'},_chart:null,_dataView:null,_selection:null,_typeChanged:function(){this.$.loader.create(this.type,this.$.chartdiv).then(function(a){var b=this.$.loader;Object.keys(this.events.concat(['select','ready']).reduce(function(a,b){return a[b]=!0,a},{})).forEach(function(c){b.fireOnChartEvent(a,c)}),this._setDrawn(!1),this._chart=a}.bind(this))},_subOptionChanged:function(a){this.options=a.base,this.debounce('optionChangeRedraw',function(){this.redraw()},5)},_setSelection:function(){this.drawn&&this.selection&&this.selection!==this._selection&&(this._chart.setSelection&&this._chart.setSelection(this.selection),this._selection=this.selection)},_updateSelection:function(){this.selection=this._selection=this._chart.getSelection()},_onChartReady:function(){this._setDrawn(!0),this._selection=null,this._setSelection()},redraw:function(){this._chart&&this._dataView&&this._draw(this._chart,this._dataView)},_draw:function(a,b){if(null!=a&&null!=b)try{this._setDrawn(!1),a.draw(b,this.options||{})}catch(a){this.$.chartdiv.innerHTML=a}},get imageURI(){return this._chart?this._chart.getImageURI():null},_viewChanged:function(a){a&&(this._dataView=a)},_rowsOrColumnsChanged:function(){var a=this.rows,b=this.cols;a&&b&&this.$.loader.dataTable().then(function(c){return b.forEach(function(a){c.addColumn(a)}),c.addRows(a),c}.bind(this)).then(this.$.loader.dataView.bind(this.$.loader)).then(function(a){this._dataView=a}.bind(this)).catch(function(a){this.$.chartdiv.innerHTML=a}.bind(this))},_dataChanged:function(a){var b;if(a){var c=!1;try{a=JSON.parse(a)}catch(b){c='string'==typeof a||a instanceof String}if(c){var d=document.createElement('iron-request');b=d.send({url:a,handleAs:'json'}).then(function(a){return a.response})}else b=Promise.resolve(a);b.then(this.$.loader.dataTable.bind(this.$.loader)).then(this.$.loader.dataView.bind(this.$.loader)).then(function(a){this._dataView=a}.bind(this))}}})})();</script></body></html>